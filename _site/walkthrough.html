<!DOCTYPE html>
<html>
  <head>
    











<!-- Basic metadata -->
<meta charset='utf-8'>
<meta http-equiv="X-UA-Compatible" content="chrome=1, IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Title and Description -->
<title>Spinnaker: Walkthrough</title>
<meta name="description" content="">

<!-- Schema.org markup for Google+ -->
<meta itemprop="name" content="Spinnaker: Walkthrough">
<meta itemprop="description" content="">
<meta itemprop="image" content="https://netflix.github.io/spinnaker/images/falcor-logo.png">

<!-- Twitter Card data -->
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@netflix">
<meta name="twitter:title" content="Spinnaker: Walkthrough">
<meta name="twitter:description" content="">
<meta name="twitter:creator" content="@netflixoss">
<meta name="twitter:image:src" content="https://netflix.github.io/spinnaker/images/falcor-logo-twitter-card.png">

<!-- Open graph metadata -->
<meta property="og:title" content="Spinnaker: Walkthrough">
<meta property="og:type" content="website">
<meta property="og:site_name" content="Falcor" />
<meta property="og:url" content="https://netflix.github.io/spinnaker/walkthrough.html">
<meta property="og:image" content="http://netflix.github.io/spinnaker/images/falcor-logo-og.png">
<meta property="og:image:secure_url" content="https://netflix.github.io/spinnaker/images/falcor-logo-og.png" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:description" content="">

<!-- All site CSS -->
<link rel="stylesheet" type="text/css" media="screen" href="/spinnaker/stylesheets/spinnaker-site.css">

<!-- All site favicons -->
<link rel="apple-touch-icon" sizes="57x57" href="/spinnaker/images/favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/spinnaker/images/favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/spinnaker/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/spinnaker/images/favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/spinnaker/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/spinnaker/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/spinnaker/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/spinnaker/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/spinnaker/images/favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="/spinnaker/images/favicons/favicons-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/spinnaker/images/favicons/favicons-194x194.png" sizes="194x194">
<link rel="icon" type="image/png" href="/spinnaker/images/favicons/favicons-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/spinnaker/images/favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/spinnaker/images/favicons/favicons-16x16.png" sizes="16x16">
<link rel="manifest" href="/spinnaker/images/favicons/manifest.json">
<meta name="msapplication-TileColor" content="#2b5797">
<meta name="msapplication-TileImage" content="/spinnaker/images/favicons/mstile-144x144.png">
<meta name="theme-color" content="#000000">

  </head>
  <body >
  <a class="sr-only" href="#main-content">Skip to main content</a>
  <header>
  <nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
      <div class="row">
        <div class="col-xs-12 col-lg-10 col-lg-offset-1">

          <!-- Branding and mobile menu button -->
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-navigation" aria-expanded="false">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/spinnaker/">
              <img class="img-plain navbar-logo" src="/spinnaker/images/spinnaker-header.png" alt="Spinnaker logo">
            </a>
          </div>

          <!-- Main navigation links -->
          <div class="navbar-collapse collapse site-navigation">
            <ul class="nav navbar-nav">
              
                
                  <li class="dropdown ">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                      Introduction <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu">
                      
                        
                        <li class="">
                          <a href="/spinnaker/starter/what_is_spinnaker.html">What is Spinnaker</a>
                        </li>
                      
                    </ul>
                  </li>
                
              </li>
              
                
                  <li class="dropdown ">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                      Guides <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu">
                      
                        
                        <li class="">
                          <a href="/spinnaker/documentation/quick_start.html">Quick Start</a>
                        </li>
                      
                        
                        <li class="">
                          <a href="/spinnaker/documentation/user_guide.html">User's Guide</a>
                        </li>
                      
                        
                        <li class="">
                          <a href="/spinnaker/documentation/integration_guide.html">Integration Guide</a>
                        </li>
                      
                        
                        <li class="">
                          <a href="/spinnaker/documentation/developer_guide.html">Developer's Guide</a>
                        </li>
                      
                    </ul>
                  </li>
                
              </li>
              
                
                  <li class="dropdown ">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                      Videos <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu">
                      
                        
                        <li class="">
                          <a href="/spinnaker/video-tutorials/spring_one_2014.html">Spring One 2014 Keynote</a>
                        </li>
                      
                        
                        <li class="">
                          <a href="/spinnaker/video-tutorials/gr8conf_2015_micro_service_architecture.html">Gr8Conf 2015 MicroService Architecture</a>
                        </li>
                      
                    </ul>
                  </li>
                
              </li>
              
                
                  
                    <li class="">
                      <a href="/spinnaker/doc/swagger.html">API Reference</a>
                    </li>
                  
                
              </li>
              
            </ul>

            <!-- Link to the project's GitHub repo & Twitter profile -->
            <ul class="nav navbar-nav navbar-right navbar-links">
              <li><a href="https://github.com/spinnaker/">GitHub</a></li>
            </ul>
          </div>

        </div>
      </div>
    </div>
  </nav>
</header>


  <!-- the id is used exclusively for easy access by assistive technology -->
  <main class="container standard-page" id="main-content">
    <div class="row">
      <div class="col-xs-12 col-lg-10 col-lg-offset-1">
        <p>In a Falcor application you access and modify your application’s JSON data using a Falcor Model object. The Falcor Model allows you to work with JSON data using familiar JavaScript operations like get, set, and call. The main difference is that the Falcor Model’s Falcor APIs are asynchronous. By providing an asynchronous API, the Falcor model allows developers to manipulate all JSON data the same way regardless of whether the data is in local memory, or in the cloud.</p>

<p>Let’s start by working with the JSON data we expect the server to provide. In this example we will use a JSON object that represents an individual Netflix member’s (abbreviated) personalized recommendations.</p>

<p>Every Netflix member gets a set of recommendations that is personalized based on their tastes. The recommended titles are organized into genres, such as horror, comedy, and action.</p>

<p>To keep the code short we will abbreviate the model to two genre lists (“New Releases” and “Recently Watched”), each of which has a single title.</p>

<p>We can use the following JavaScript code to retrieve the name of the first title in the first genre list.</p>

<pre><code class="language-js">var model = {
    genreLists: [
        {
            name: 'Recently Watched',
            titles: [
                {
                    id: 1007,
                    name: 'Bloodline',
                    rating: 4,
                    boxshot: '../assets/bl.webp'
                }
                //, ... more titles
            ]
        },
        {
            name: 'New Releases',
            titles: [
                {
                    id: 956,
                    name: 'House of Cards',
                    rating: 4,
                    boxshot: '../assets/hoc.webp'
                }
                //, ... more titles
            ]
        }
        //, ... more genres
    ]
};

console.log(model.genreLists[0].titles[0].name);
</code></pre>

<p>The code above outputs the following to the console:
~~~js
Bloodline 
~~~</p>

<p>Instead of working with the JSON data directly, let’s load it into a Falcor model.  To retrieve the name of the first title in the first list from the Falcor Model, we can use the same JavaScript path we used on the JSON object. Note that the only difference is that the model returns a promise, which resolves to the result asynchronously.</p>

<pre><code class="language-js">var cache = {
    genreLists: [
        {
            name: 'Recently Watched',
            titles: [
                {
                    id: 1007,
                    name: 'Bloodline',
                    rating: 4,
                    boxshot: '../assets/bl.webp'
                }
                //, ... more titles
            ]
        },
        {
            name: 'New Releases',
            titles: [
                {
                    id: 956,
                    name: 'House of Cards',
                    rating: 4,
                    boxshot: '../assets/hoc.webp'
                }
                //, ... more titles
            ]
        }
        //, ... more genres
    ]
};

var model = new falcor.Model({cache: cache});

model.getValue('genreLists[0].titles[0].name').then(function(x) {
    console.log(JSON.stringify(x, null, 4));
});
</code></pre>

<p>The code above outputs the following to the console:
~~~js
“Bloodline”
~~~</p>

<p>In addition to normal JavaScript path syntax, models also support ranges in indexers. In the example below we use a range to retrieve the names of the titles in both of the genre lists.</p>

<pre><code class="language-js">var cache = {
    genreLists: [
        {
            name: 'Recently Watched',
            titles: [
                {
                    id: 1007,
                    name: 'Bloodline',
                    rating: 4,
                    boxshot: '../assets/bl.webp'
                }
                //, ... more titles
            ]
        },
        {
            name: 'New Releases',
            titles: [
                {
                    id: 956,
                    name: 'House of Cards',
                    rating: 4,
                    boxshot: '../assets/hoc.webp'
                }
                //, ... more titles
            ]
        }
        //, ... more genres
    ]
};

var model = new falcor.Model({cache: cache});

model.get('genreLists[0..1].titles[0].name').then(function(x) {
    console.log(JSON.stringify(x, null, 4));
});
</code></pre>

<p>The code above outputs the following to the console:
~~~js
{
    “json”: {
        “genreLists”: {
            “0”: {
                “titles”: {
                    “0”: {
                        “name”: “Bloodline”
                    }
                }
            },
            “1”: {
                “titles”: {
                    “0”: {
                        “name”: “House of Cards”
                    }
                }
            }
        }
    }
}
~~~</p>

<p>In addition to using ranges to select multiple values, you can also select multiple values by passing multiple paths to a model. In this example we select the name and rating of the titles in both genre lists.</p>

<pre><code class="language-js">var cache = {
    genreLists: [
        {
            name: 'Recently Watched',
            titles: [
                {
                    id: 1007,
                    name: 'Bloodline',
                    rating: 4,
                    boxshot: '../assets/bl.webp'
                }
                //, ... more titles
            ]
        },
        {
            name: 'New Releases',
            titles: [
                {
                    id: 956,
                    name: 'House of Cards',
                    rating: 4,
                    boxshot: '../assets/hoc.webp'
                }
                //, ... more titles
            ]
        }
        //, ... more genres
    ]
};

var model = new falcor.Model({cache: cache});

model.get(
    'genreLists[0..1].titles[0].name', 'genreLists[0..1].titles[0].rating').
    then(function(x) {
        console.log(JSON.stringify(x, null, 4));
    });
</code></pre>

<p>The code above outputs the following to the console:
~~~js
{
    “json”: {
        “genreLists”: {
            “0”: {
                “titles”: {
                    “0”: {
                        “name”: “Bloodline”,
                        “rating”: 4
                    }
                }
            },
            “1”: {
                “titles”: {
                    “0”: {
                        “name”: “House of Cards”,
                        “rating”: 4
                    }
                }
            }
        }
    }
} 
~~~</p>

<p>The two paths above can be collapsed into one, because Falcor allows multiple keys to be passed into indexers.</p>

<pre><code class="language-js">model.get(
    'genreLists[0..1].titles[0]["name", "rating"]').
    then(function(x) {
        console.log(JSON.stringify(x, null, 4));
    });
</code></pre>

<p>The code above will produce the same console output as the last example.</p>

<p>Falcor makes it easy to work with JSON data. Unfortunately using JSON data to model your application’s domain data can cause problems.</p>

<p>For example, when you watch a Netflix title, the title appears at the front of your “Recently Watched” genre list. If we were to watch house of cards, the JSON object would look like this:</p>

<pre><code class="language-js">var cache = {
    genreLists: [
        {
            name: 'Recently Watched',
            titles: [
                {
                    id: 956,
                    name: 'House of Cards',
                    rating: 4,
                    boxshot: '../assets/hoc.webp'
                }
                //, ... more titles
            ]
        },
        {
            name: 'New Releases',
            titles: [
                {
                    id: 956,
                    name: 'House of Cards',
                    rating: 4,
                    boxshot: '../assets/hoc.webp'
                }
                //, ... more titles
            ]
        }
        //, ... more genres
    ]
};
</code></pre>

<p>Notice that the “house of cards” title appears twice in the JSON object. Now let’s say that I Netflix user give the title in the recently watchlist a rating of five. This is accomplished using the model’s set operation.</p>

<pre><code class="language-js">var model = new falcor.Model({cache: cache});

model.setValue(
    'genreLists[0].titles[0].rating', 5).
    then(function() {
        return model.get('genreLists[0..1].titles[0]["name", "rating"]')
    }).
    then(function(x) {
        console.log(JSON.stringify(x, null, 4));
    });
</code></pre>

<p>The code above outputs the following to the console:
~~~js
{
    “json”: {
        “genreLists”: {
            “0”: {
                “titles”: {
                    “0”: {
                        “name”: “House of Cards”,
                        “rating”: 5
                    }
                }
            },
            “1”: {
                “titles”: {
                    “0”: {
                        “name”: “House of Cards”,
                        “rating”: 4
                    }
                }
            }
        }
    }
} 
~~~</p>

<p>Now take a close look at the JSON object in the model. Noticed that the rating is only reflected in the “house of cards” object in the recently watched list. If the user scrolls down and sees the same title in the New releases list, the rating will not reflect their changes.</p>

<p>This is a common problem experienced by applications that use JSON as a data interchange format: their application domain models are graphs, but JSON models information as a tree.</p>

<p>When sending subsets of their domain graph over the wire as JSON, most applications</p>

<p>Netflix for example can display related titles screen for any individual title, which means that the Netflix domain model is a graph where any title may be related to every other title indirectly through the graph. This is very common. For example in the Amazon application, any product May be related to any other product based on similar characteristics, consumer buying habits, and so on.</p>

<p>In addition to retrieving values, we can also set values using the path syntax. In this example we set the rating of the “house of cards” title.</p>

<p>Note that the “house of cards” title appears in two genre lists: “suggestions for you” and “new releases.” Unfortunately because the title object has been duplicated in the JSON object, our rating is only applied to one of the copies. That means that the other copy contains stale data.</p>

<p>This is an good demonstration of the problem with using JSON as a data modeling or interchange format. Most applications have a domain model which is organized into a graph. When a subset of an application’s domain graph is sent across the network, it is converted into a JSON tree and duplicates are introduced.  In order to avoid data stale data, application clients must use unique identifiers to remove duplicates before storing objects in the local cache. This process is often manual, and specialized logic is usually written for each new type in a domain model or network message. Despite this inconvenience, developers love the convenience of JSON because it universally understood and easily serialized and sent across the network.</p>

<p>To solve the problem of JSON, Falcor           allows you to use a convention for modeling graphs and JSON: JSON graph. If you use the JSON graph format, you can insert references into the serial tree. It’s easy to convert JSON objects into JSON graph format: simply move each object with an id into a unique location in the JSON object, and replace all other instances with a reference to the unique location.</p>

<p>All titles in Netflix have a unique integer identifer, First we add the “House of Cards” title to a new  “titlesById” map at the root of the document. We place the title under its identifier</p>

<p>Now we</p>

        
      </div>
    </div>
  </main>
  
  <footer class="site-footer">
  <div class="container">
    <div class="row">
      <div class="col-xs-12 col-lg-10 col-lg-offset-1">
        <div class="row">
          <div class="col-xs-4 site-footer-item">
            <a href="https://www.netflix.com" target="_blank">
              <img class="netflix-logo" src="/spinnaker/images/netflix-logo.svg" alt="Netflix logo">
            </a>
          </div>
          <div class="col-xs-8 text-right site-footer-item footer-links">
            <div>
              <a href="https://netflix.github.io/" target="_blank">Netflix Open Source Platform</a><br>
              <span class="copyright-notice">
                
                &copy; 2015
                NETFLIX, INC. ALL RIGHTS RESERVED
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</footer>

  
  <!-- JQuery (cdn and local fallback) for the bootstrap plugins -->
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script>if (!window.jQuery) {document.write('<script src="/spinnaker/javascripts/jquery-2.1.4.min.js"><\/script>');}</script>
<script src="/spinnaker/javascripts/bootstrap-modified.min.js"></script>
<script src="/spinnaker/javascripts/modernizr-custom.min.js"></script>
<script src="/spinnaker/javascripts/prettify/prettify-bundle.min.js"></script>

<script>
  $(document).ready(function () {
    // =============================================
    // = Initialize Table of Contents (If Present) =
    // =============================================
    
    // Since we can't touch the kramdown autogenrated TOC code,
    // instead just wrap it in the sitewide TOC class, since the rest
    // of it is very reasonably structured.
    $('#markdown-toc').wrap('<div class="table-of-contents"></div>');
    
    // Make the kramdown generated toc into a valid bootstrap nav
    $('#markdown-toc').addClass('nav');
    
    // To prevent flash-of-awkwardly-styled-content, the toc is hidden until
    // the processing above is done.
    $('.toc-page').removeClass('not-ready');
    $('body').scrollspy({
      target: '.table-of-contents', 
      offset: 75
    });
    

    // ========================
    // = Prettify Code Blocks =
    // ========================
    
    // Transform all pre blocks that were presumably autogenerated by markdown so
    // they'll be prettified too
    $('pre:not([class])').addClass('prettyprint source');
    
    // Kramdown puts the language on the code element, but we want it on the pre
    // so the background can be styled too and we can vary the theme depending on
    // which language it is. The simplest solution is just to grab all the classes.
    $('.prettyprint').each(function (index, prettyPrintNode) {
      var classList = $(prettyPrintNode).children('code').attr('class');
      $(prettyPrintNode).addClass(classList);
    })
    
    window.prettyPrint();
    
    // Copied directly from the linenumbers.js file included with the
    // default JSDoc theme.
    (function () {
        var source = document.getElementsByClassName('prettyprint source linenums');
        var i = 0;
        var lineNumber = 0;
        var lineId;
        var lines;
        var totalLines;
        var anchorHash;

        if (source && source[0]) {
            anchorHash = document.location.hash.substring(1);
            lines = source[0].getElementsByTagName('li');
            totalLines = lines.length;

            for (; i < totalLines; i++) {
                lineNumber++;
                lineId = 'line' + lineNumber;
                lines[i].id = lineId;
                if (lineId === anchorHash) {
                    lines[i].className += ' selected';
                }
            }
        }
    })();
  });    
</script>


</body>

  
</html>
